<html>
	<head>
		<title>My first Three.js app</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
	      <video id="videoSource" muted autoplay width="240px" height="100px"></video>
	      	</body>
		<script src="js/vendor/three.min.js"></script>
		<script src="js/vendor/THREEx.KeyboardState.js"></script>
		<script src="js/vendor/clmtrackr.js"></script>
		<script src="js/vendor/camera.js"></script>		
		<script src="js/vendor/model_pca_20_svm.js"></script>
<!-- 				<video id="videoel" width="0" height="0" preload="auto" loop>
				</video> -->
		<script>

			//VIDEOINPUT
		  	// var videoInput = document.getElementById('inputVideo');

  			// var ctracker = new clm.tracker();
  			// ctracker.init(pModel);
  			// ctracker.start(videoInput);

			var ctracker = new clm.tracker({useWebGL : true});
			ctracker.init(pModel);
			var vid = document.getElementsByTagName('video')[0];
			ctracker.start(vid);



			//CAMERA

			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

			//SCENE
			var scene = new THREE.Scene();
			scene.fog = new THREE.Fog( 0xffffff, 1000, 10000 );//////////////////


			// // LIGHTS

			// var directionalLight = new THREE.DirectionalLight( 0xffffff, 1.475 );
			// directionalLight.position.set( 100, 100, -100 );
			// scene.add( directionalLight );


			// var hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 1.25 );
			// hemiLight.color.setHSL( 0.6, 1, 0.75 );
			// hemiLight.groundColor.setHSL( 0.1, 0.8, 0.7 );
			// hemiLight.position.y = 500;
			// scene.add( hemiLight );

			//RENDERER
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );


			//CUBE

			var geometry = new THREE.BoxGeometry( 1, 1, 1 );
			var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
			var cube = new THREE.Mesh( geometry, material );
			scene.add( cube );


			var resetCube = function(){
				cube.position.z =0;
				cube.position.x = (Math.random()-0.5)*10;
				// console.log(cube.position.x);				
			}

			var isCatched = function(){
				if(Math.round(camera.position.x-cube.position.x)<=0.3)
					console.log("Yay ");
				else
					console.log("No Catch");
			}


			resetCube();
			
			// var aPosX;
			var aPos;

			function positionLoop() {
    			requestAnimationFrame(positionLoop);
    			var positions = ctracker.getCurrentPosition();
    			aPos=positions[33];
    			//var aPosX=aPos[0];
    			// console.log(aPos[0]);
					    // positions = [[x_0, y_0], [x_1,y_1], ... ]
					    // do something with the positions ...
			}
			positionLoop();

			camera.position.z = 5;
			var keyboard = new THREEx.KeyboardState();
			var render = function () {
				requestAnimationFrame( render );



				// cube.rotation.x += 0.1;
				// cube.rotation.y += 0.1;
				cube.position.z +=0.05;
				if(cube.position.z>=camera.position.z) {
					isCatched();
					resetCube();
				};
				if(keyboard.pressed("left")) camera.position.x -= 0.05;
				if(keyboard.pressed("right")) camera.position.x += 0.05;
				if(aPos){
					// camera.position.x -= 2*(aPos[0]-120)/12000;
					camera.position.x = 20*((240-aPos[0])/240-0.5);
				}

				renderer.render(scene, camera);
			};

			render();
		</script>

</html>


