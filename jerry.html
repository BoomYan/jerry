<html>
	<head>
		<title>Jerry</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
			a {font-size: 100px;color:blue;}
		</style>
	</head>
	<body>
	      <video id="videoSource" muted autoplay width="240px" height="100px"></video>
	      <a id="Catch"></a>
	      <a id="Count"></a>
	      	</body>
		<script src="js/vendor/three.min.js"></script>
		<script src="js/vendor/THREEx.KeyboardState.js"></script>
		<script src="js/vendor/clmtrackr.js"></script>
		<script src="js/vendor/camera.js"></script>		
		<script src="js/vendor/model_pca_20_svm.js"></script>
		<script src="js/vendor/OrbitControls.js"></script>
<!-- 				<video id="videoel" width="0" height="0" preload="auto" loop>
				</video> -->
		<script>


			//UNIVERSAL VARIABLES
			var cubeSize=1;
			var disBetTandJ=5;
			
			//CAMERA TRACKER
			var ctracker = new clm.tracker({useWebGL : true});
			ctracker.init(pModel);
			var vid = document.getElementsByTagName('video')[0];
			ctracker.start(vid);



			//CAMERA

			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
			camera.rotation.y=180 * Math.PI / 180;

			//SCENE
			var scene = new THREE.Scene();
//			scene.fog = new THREE.Fog( 0xffffff, 1000, 10000 );//////////////////

			scene.fog = new THREE.Fog( 0xffffff, 1, 5000 );
			scene.fog.color.setHSL( 0.6, 0, 1 );

			// LIGHTS

			hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.6 );
			hemiLight.color.setHSL( 0.6, 1, 0.6 );
			hemiLight.color.setHSL( 0.6, 1, 0.95 );

			hemiLight.groundColor.setHSL( 0.095, 1, 0.75 );
			hemiLight.position.set( 0, 500, 0 );
			scene.add( hemiLight );

			var light = new THREE.PointLight( 0xffffff, 1, 100 );
			light.position.set( 0, 0, 10 );
			light.color.setHSL( 0.1, 1, 0.95 );

			light.shadowDarkness =0.35;
			scene.add( light );


			// GROUND
			var groundGeo = new THREE.PlaneBufferGeometry( 10000, 10000 );
			var groundMat = new THREE.MeshPhongMaterial( { ambient: 0xffffff, color: 0xffffff, specular: 0x050505 } );
			groundMat.color.setHSL( 0.095, 1, 0.75 );
			var ground = new THREE.Mesh( groundGeo, groundMat );
			ground.rotation.x = -Math.PI/2;
			ground.position.y = -3;
			scene.add( ground );

			ground.receiveShadow = true;


			//RENDERER
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			renderer.shadowMapEnabled = true;
			renderer.shadowMapType = THREE.PCFSoftShadowMap;
			renderer.shadowMapCullFace = THREE.CullFaceBack;
			document.body.appendChild( renderer.domElement );


			//Cube0

			var geometry = new THREE.BoxGeometry( 1, 1, 1 );
			var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
			var cube0 = new THREE.Mesh( geometry, material );
			scene.add( cube0 );
			cube0.position.z=100;
			//Cube1 - Jerry

			var geometry = new THREE.BoxGeometry( cubeSize, cubeSize, cubeSize );
			var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
			var jerry = new THREE.Mesh( geometry, material );
			jerry.castShadow = true;
			jerry.receiveShadow = false;
			scene.add( jerry );

			//Cube2 - Tom

			var geometry = new THREE.BoxGeometry( cubeSize, cubeSize, cubeSize);
			var material = new THREE.MeshBasicMaterial( { color: 0x0000ff } );
			var tom = new THREE.Mesh( geometry, material );
			tom.castShadow = true;
			tom.receiveShadow = false;
			scene.add( tom );
			tom.position.z = disBetTandJ;

			var resetJerry = function(){
				jerry.position.z =-5;
				jerry.position.x = (Math.random()-0.5)*20;
				// console.log(cube.position.x);				
			}

			var isCatched = function(){
				if(Math.abs(tom.position.x-jerry.position.x)<=cubeSize*1.5){
					console.log("Yay ");
					document.getElementById('Catch').innerHTML = 'Yay'
				}
				
				else{
					console.log("No Catch");
				
				document.getElementById('Catch').innerHTML = 'No Catch!'
			}
			}
			//CONTROLS
			// var controls = new THREE.OrbitControls( camera );


			resetJerry();
			
			// var aPosX;
			var aPos;
			var shift=0;
			//var keyboard = new THREEx.KeyboardState();
    		

    		var faceDetection = function(){
    			var positions = ctracker.getCurrentPosition();
    			aPos=positions[33];
    		}

			var updateJerry = function(){
				jerry.position.z +=0.08;
				faceDetection();
				if(aPos){
					 shift= 5*(aPos[0]-120)/1200; //120~-120
					// camera.position.x = 20*((240-aPos[0])/240-0.5); //10- -10
				}
				jerry.position.x +=shift;
			}

			var updateTom = function(){
				var step=0.3
				if(tom.position.x>jerry.position.x)
				tom.position.x -=step;
				else tom.position.x+=step;
			}


			var nextTom = function(){
				tom.position.z+=disBetTandJ;
				cube0.position.z+=disBetTandJ;
			}

			var setCamera = function(x,y,z){
				camera.position.x=x;
				camera.position.y=y;
				camera.position.z=z;
			}

			var render = function () {

				updateJerry();
				updateTom();
				if(Math.abs(jerry.position.z-tom.position.z)<cubeSize) {
					isCatched();
					// resetJerry();
					nextTom();
				};
				setCamera(jerry.position.x,jerry.position.y,jerry.position.z);
				// controls.update;
				renderer.render(scene, camera);
			};

			function animate() {

				requestAnimationFrame( animate );

				render();

			}
			animate();
		</script>

</html>


